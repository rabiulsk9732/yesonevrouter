#!/bin/bash
#
# YESRouter vBNG - Bison-Style Environment Configuration
# /etc/yesrouter/yesrouter.env
#
# This file is the SINGLE SOURCE OF TRUTH for all runtime parameters.
# Every value is validated at startup. No hardcoded defaults allowed.
#

#
# DPDK Core Configuration
#
DPDK_MAIN_LCORE=0                        # Main control plane lcore
DPDK_WORKER_LCORES="1,2,3,4"             # Worker lcores (RX/NAT processing)
DPDK_NUMA_NODE=0                         # NUMA socket (must match NIC)

#
# DPDK Memory Configuration
#
DPDK_SOCKET_MEM_MB=2048                  # Memory per NUMA socket (MB)
DPDK_MBUF_COUNT=262144                   # Total mbufs (must be power of 2)
DPDK_MBUF_CACHE_SIZE=512                 # Per-lcore mbuf cache
DPDK_MBUF_DATA_ROOM=2048                 # Bytes per mbuf (must fit MTU + headroom)

#
# DPDK Hugepage Configuration
#
DPDK_HUGEPAGES=2048                      # Number of 2MB hugepages
DPDK_HUGEPAGE_SIZE="2M"                  # Hugepage size (2M or 1G)

#
# NIC Configuration
#
DPDK_PORTS="0000:01:00.0"                # PCI addresses (space-separated)
DPDK_DRIVER="uio_pci_generic"            # DPDK driver (vfio-pci, uio_pci_generic, igb_uio)
DPDK_PORT_MTU=1500                       # MTU for all ports

#
# DPDK Queue Configuration (Per-Port)
#
DPDK_RX_QUEUES=4                         # Number of RX queues per port
DPDK_TX_QUEUES=4                         # Number of TX queues per port
DPDK_RX_DESC=2048                        # RX descriptors per queue
DPDK_TX_DESC=2048                        # TX descriptors per queue

#
# DPDK Burst Sizes (Performance Tuning)
#
DPDK_RX_BURST_SIZE=64                    # Packets per RX burst (16, 32, 64, 128)
DPDK_TX_BURST_SIZE=64                    # Packets per TX burst (16, 32, 64, 128)

#
# RSS Configuration (Flow Steering)
#
DPDK_RSS_ENABLE=true                     # Enable RSS for multi-queue
DPDK_RSS_HASH_KEY="symmetric"            # RSS key type (symmetric, toeplitz, random)

#
# Worker Thread Configuration
#
WORKER_RX_THREADS=4                      # RX worker threads (1 per RX queue)
WORKER_NAT_THREADS=4                     # NAT worker threads (must match RX)
WORKER_TX_THREADS=4                      # TX worker threads (must match TX queues)

#
# NAT44 Configuration
#
NAT44_ENABLE=true                        # Enable NAT44 subsystem
NAT44_HAIRPIN_ENABLE=true                # Enable NAT hairpin (loopback)
NAT44_MAX_SESSIONS=1048576               # Max concurrent sessions (power of 2)
NAT44_SESSION_HASH_BUCKETS=65536         # Hash table buckets (power of 2)
NAT44_PORT_BLOCK_SIZE=64                 # Ports per block
NAT44_MIN_PORT=1024                      # Min NAT port
NAT44_MAX_PORT=65535                     # Max NAT port

#
# NAT Performance Tuning (Lockless)
#
NAT44_LOCKLESS_ENABLE=true               # Enable lockless per-core session pools
NAT44_SESSION_CACHE_SIZE=256             # Per-worker L1 cache entries
NAT44_PREFETCH_LOOKAHEAD=4               # Prefetch N sessions ahead

#
# NAT Pool Configuration
#
NAT44_POOL_START="203.0.113.1"           # NAT pool start IP
NAT44_POOL_END="203.0.113.254"           # NAT pool end IP

#
# NAT Timeouts (Seconds)
#
NAT44_TIMEOUT_UDP=300                    # UDP session timeout
NAT44_TIMEOUT_TCP=7200                   # TCP session timeout
NAT44_TIMEOUT_ICMP=60                    # ICMP session timeout

#
# Logging Configuration
#
LOG_LEVEL=6                              # Log level (0=emerg, 7=debug)
LOG_FILE="/var/log/yesrouter/yesrouter.log"
LOG_SYSLOG_ENABLE=true

#
# Runtime Directories
#
RUNTIME_DIR="/var/run/yesrouter"
DPDK_RUNTIME_DIR="/var/run/dpdk"
CONFIG_DIR="/etc/yesrouter"

#
# Performance Monitoring
#
STATS_ENABLE=true                        # Enable statistics collection
STATS_UPDATE_INTERVAL_MS=1000            # Stats update interval (ms)

#
# Validation Flags (Set by parser)
#
CONFIG_VALIDATED=false                   # Set to true after successful parse
